<?xml version="1.0" encoding="utf-8"?>

<odoo>
    <template id="fish_farm_dashboard_template" name="Fish Farm Dashboard Page">
        <t t-call="web.layout">
            <t t-set="title">Fish Farm Dashboard</t>
            
<div class="container mt-4">
    <form method="get" action="/fish_farm/dashboard" class="mb-4">
        <div class="row">
            <div class="col-md-3">
                <label>From Date</label>
                <input type="date" name="date_from" class="form-control"/>
            </div>
            <div class="col-md-3">
                <label>To Date</label>
                <input type="date" name="date_to" class="form-control"/>
            </div>
            <div class="col-md-3">
                <label>Pond</label>
                <select name="pond_id" class="form-control">
                    <t t-foreach="ponds" t-as="pond">
                        <option t-att-value="pond.id" t-esc="pond.name"/>
                    </t>
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Filter</button>
            </div>
        </div>
    </form>

<t t-if="feeding_alert">
            <div class="alert alert-danger">⚠️ Feeding exceeded the configured limit!</div>
        </t>
        <t t-if="fishing_alert">
            <div class="alert alert-warning">⚠️ Fishing exceeded the configured limit!</div>
        </t>
                <h1 class="mb-3">Fish Farm Dashboard</h1>
                <div class="row mb-4">
                    <div class="col-md-2"><div class="card text-center"><div class="card-body"><h4>Seeded (KG)</h4><p><t t-esc="total_seeds"/></p></div></div></div>
<div class="col-md-2"><div class="card text-center"><div class="card-body"><h4>Feeding (KG)</h4><p><t t-esc="total_feeding"/></p></div></div></div>
<div class="col-md-2"><div class="card text-center"><div class="card-body"><h4>Fishing (KG)</h4><p><t t-esc="total_fishing"/></p></div></div></div>
<div class="col-md-2"><div class="card text-center"><div class="card-body"><h4>Supplying (KG)</h4><p><t t-esc="total_supplying"/></p></div></div></div>
<div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body"><h4>Ponds</h4><p><t t-esc="pond_count"/></p>
                                <h5 class="card-title">Ponds</h5>
                                <p class="card-text" t-attf-id="pond_count">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Seed (KG)</h5>
                                <p class="card-text" t-attf-id="total_seed">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Feed (KG)</h5>
                                <p class="card-text" t-attf-id="total_feed">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Fishing (KG)</h5>
                                <p class="card-text" t-attf-id="total_fishing">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Supplying (KG)</h5>
                                <p class="card-text" t-attf-id="total_supplying">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h4>Feed Trend (Last 7 Days)</h4>
                <canvas id="feedChart" style="width:100%; height:300px;"></canvas>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                odoo.define('fish_farm_dashboard.dashboard', function (require) {
                    "use strict";
                    const ajax = require('web.ajax');

                    ajax.jsonRpc("/fish_farm/dashboard/data", 'call', {}).then(function (data) {
                        document.getElementById("pond_count").innerText = data.pond_count;
                        document.getElementById("total_seed").innerText = data.total_seed;
                        document.getElementById("total_feed").innerText = data.total_feed;
                        document.getElementById("total_fishing").innerText = data.total_fishing;
                        document.getElementById("total_supplying").innerText = data.total_supplying;

                        const ctx = document.getElementById('feedChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: data.feed_chart.labels,
                                datasets: [{
                                    label: 'Feed (KG)',
                                    data: data.feed_chart.data,
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 2,
                                    fill: false
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: { beginAtZero: true }
                                }
                            }
                        });
                    });
                });
            </script>
        </t>
    </template>
</odoo>
